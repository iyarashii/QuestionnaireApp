@page "{questions?}"
@model QuestionnaireApp.Pages.Questionnaires.CreateModel
@using QuestionnaireApp.Models;
@{
    ViewData["Title"] = "Create Questionnaire";
}

<h1>Create</h1>

<h4>Questionnaire</h4>
<hr />
<div class="row">
    <div class="col-md-4">
        <form method="post">
            <div asp-validation-summary="ModelOnly" class="text-danger"></div>
            <div class="form-group">
                <label asp-for="Questionnaire.Title" class="control-label"></label>
                <input asp-for="Questionnaire.Title" class="form-control" />
                <span asp-validation-for="Questionnaire.Title" class="text-danger"></span>
            </div>
            <div class="form-group">
                <label asp-for="Questionnaire.Description" class="control-label"></label>
                <input asp-for="Questionnaire.Description" class="form-control" />
                <span asp-validation-for="Questionnaire.Description" class="text-danger"></span>
            </div>
            <div class="form-group">
                <label asp-for="Questionnaire.DueDate" class="control-label"></label>
                <input asp-for="Questionnaire.DueDate" class="form-control" />
                <span asp-validation-for="Questionnaire.DueDate" class="text-danger"></span>
            </div>
            <div class="form-group">
                <label asp-for="Questionnaire.Targets" class="control-label"></label>
                <div class="table">
                    <table>
                        <tr>
                            @{
                                int cnt = 0;

                                foreach (var group in Model.QuestionnaireAssignedGroupsDataList)
                                {
                                    if (cnt++ % 6 == 0)
                                    {
                                    @:</tr><tr>
                                    }
                                    @:<td>
                                        <input type="checkbox"
                                               name="selectedGroups"
                                               value="@group.GroupID"
                                               @(Html.Raw(group.Assigned ? "checked=\"checked\"" : "")) />
                                        @group.Name
                                    @:</td>
                                }
                            @:</tr>
                            }
                        </table>
                    </div>
                <span asp-validation-for="Questionnaire.Targets" class="text-danger"></span>
             </div>
            @*First Question and its answers*@
                <div class="form-group">
                    <label asp-for="Questionnaire.Questions[0].Content" class="control-label"></label>&nbsp;1
                    <input asp-for="Questionnaire.Questions[0].Content" class="form-control" />
                    <input asp-for="Questionnaire.Questions[0].Number" type="hidden" value="1"/>
                    <span asp-validation-for="Questionnaire.Questions[0].Content" class="text-danger"></span>
                </div>
                <div class="form-group">
                    <label class="control-label">Question 1 Type</label>
                    <select asp-for="Questionnaire.Questions[0].QuestionType" class="form-control"
                            asp-items="@Html.GetEnumSelectList<QuestionTypes>()"></select>
                    <span asp-validation-for="Questionnaire.Questions[0].QuestionType" class="text-danger"></span>
                </div>
                <div class="form-group">
                    <label class="control-label">@Html.DisplayNameFor(model => model.Questionnaire.Questions[0].Content)&nbsp;1 -</label>
                    <label asp-for="Questionnaire.Questions[0].Answers[0].Content" class="control-label"></label>&nbsp;1
                    <input asp-for="Questionnaire.Questions[0].Answers[0].Content" class="form-control" />
                    <input asp-for="Questionnaire.Questions[0].Answers[0].Number" type="hidden" value="1" />
                    <span asp-validation-for="Questionnaire.Questions[0].Answers[0].Content" class="text-danger"></span>
                </div>
                <div class="form-group">
                    <label class="control-label">@Html.DisplayNameFor(model => model.Questionnaire.Questions[0].Content)&nbsp;1 -</label>
                    <label asp-for="Questionnaire.Questions[0].Answers[1].Content" class="control-label"></label>&nbsp;2
                    <input asp-for="Questionnaire.Questions[0].Answers[1].Content" class="form-control" />
                    <input asp-for="Questionnaire.Questions[0].Answers[1].Number" type="hidden" value="2" />
                    <span asp-validation-for="Questionnaire.Questions[0].Answers[1].Content" class="text-danger"></span>
                </div>
                @* div for answers generated by the addAnswers script *@
                <div id="question1Answers" class="form-group"></div>
                <div class="form-group">
                    <a href="javascript:void(0)" id="addQ1Answers" onclick="addAnswers(0, 'question1Answers')">Add answer</a>
                </div>
            <script>
                // JS script for answers generation
                var answersArray = [];
                // amount of questions that you can add
                for (var y = 0; y < 100; y++) {
                    answersArray[y] = 2;
                }
                function addAnswers(qIndex, containerID) {
                    // Container <div> where dynamic content will be placed
                    var container = document.getElementById(containerID);
                    var ansInput = document.createElement("input");
                    var ansInputNumber = document.createElement("input");
                    var ansLabel = document.createElement("label");
                    ansLabel.textContent = `Question ${qIndex+1} - Answer ${answersArray[qIndex]+1}`;
                    container.appendChild(ansLabel);
                    container.appendChild(document.createElement("br"));
                    ansInput.type = "text";
                    ansInput.className += "form-control";
                    ansInput.required = true;
                    ansInput.id = `Questionnaire_Questions_${qIndex}__Answers_${answersArray[qIndex]}__Content`;
                    ansInput.name = `Questionnaire.Questions[${qIndex}].Answers[${answersArray[qIndex]}].Content`;
                    ansInputNumber.type = "hidden";
                    ansInputNumber.value = answersArray[qIndex]+1;
                    ansInputNumber.id = `Questionnaire_Questions_${qIndex}__Answers_${answersArray[qIndex]}__Number`;
                    ansInputNumber.name = `Questionnaire.Questions[${qIndex}].Answers[${answersArray[qIndex]}].Number`;
                    container.appendChild(ansInput);
                    container.appendChild(ansInputNumber);
                    container.insertAdjacentHTML('beforeend', String.raw`<span class="text-danger field-validation-valid" data-valmsg-for="Questionnaire.Questions[${qIndex}].Answers[${answersArray[qIndex]}].Content" data-valmsg-replace="true"></span><br/>`);
                    answersArray[qIndex]++;
                }
            </script>
            @* div for questions generated by the addQuestions script *@
            <div id="additionalQuestions" class="form-group"></div>
                <div class="form-group">
                    <a href="javascript:void(0)" id="addQ" onclick="addQuestions()">Add question</a>
                </div>
                <script>
                    var q = 1;
                    function addQuestions() {
                        // main container
                        var questionsContainer = document.getElementById('additionalQuestions');

                        // div for question content and number
                        var qContentDiv = document.createElement("div");
                        var qContentLabel = document.createElement("label");
                        var qContentInput = document.createElement("input");
                        var qNumberInput = document.createElement("input");
                        // div
                        qContentDiv.className += "form-group";
                        qContentDiv.id = `qContentDiv${q}`;
                        questionsContainer.appendChild(qContentDiv);
                        // label
                        qContentLabel.textContent = `Question ${q + 1}`;
                        qContentDiv.appendChild(qContentLabel);
                        qContentDiv.appendChild(document.createElement("br"));
                        // input content and number
                        qContentInput.type = "text";
                        qContentInput.className += "form-control";
                        qContentInput.required = true;
                        qContentInput.id = `Questionnaire_Questions_${q}__Content`;
                        qContentInput.name = `Questionnaire.Questions[${q}].Content`;
                        qNumberInput.type = "hidden";
                        qNumberInput.value = q + 1;
                        qNumberInput.id = `Questionnaire_Questions_${q}__Number`;
                        qNumberInput.name = `Questionnaire.Questions[${q}].Number`;
                        qContentDiv.appendChild(qContentInput);
                        qContentDiv.appendChild(qNumberInput);
                        qContentDiv.insertAdjacentHTML('beforeend', String.raw`<span class="text-danger field-validation-valid" data-valmsg-for="Questionnaire.Questions[${q}].Content" data-valmsg-replace="true"></span>`);

                        // div for question type
                        var qTypeDiv = document.createElement("div");
                        var qTypeLabel = document.createElement("label");
                        var qTypeSelect = document.createElement("select");
                        // div
                        qTypeDiv.className += "form-group";
                        qTypeDiv.id = `qTypeDiv${q}`;
                        questionsContainer.appendChild(qTypeDiv);
                        // label
                        qTypeLabel.textContent = `Question ${q + 1} Type`;
                        qTypeDiv.appendChild(qTypeLabel);
                        // question type select
                        qTypeSelect.className += "form-control";
                        qTypeSelect.id = `Questionnaire_Questions_${q}__QuestionType`;
                        qTypeSelect.name = `Questionnaire.Questions[${q}].QuestionType`;
                        var option0 = document.createElement("option");
                        var option1 = document.createElement("option");
                        option0.value = 0;
                        option0.text = "Multiple choice";
                        option1.value = 1;
                        option1.text = "Single choice";
                        qTypeSelect.options.add(option0);
                        qTypeSelect.options.add(option1);
                        qTypeDiv.appendChild(qTypeSelect);
                        qTypeDiv.insertAdjacentHTML('beforeend', String.raw`<span class="text-danger field-validation-valid" data-valmsg-for="Questionnaire.Questions[${q}].QuestionType" data-valmsg-replace="true"></span>`);

                        // ans 1 div
                        var ans1Div = document.createElement("div");
                        var ans1Input = document.createElement("input");
                        var ans1InputNumber = document.createElement("input");
                        var ans1Label = document.createElement("label");
                        // div
                        ans1Div.className += "form-group";
                        ans1Div.id = `ans1Div${q}`;
                        questionsContainer.appendChild(ans1Div);
                        // label
                        ans1Label.textContent = `Question ${q+1} - Answer 1`;
                        ans1Div.appendChild(ans1Label);
                        ans1Div.appendChild(document.createElement("br"));
                        // input content and number
                        ans1Input.type = "text";
                        ans1Input.className += "form-control";
                        ans1Input.required = true;
                        ans1Input.id = `Questionnaire_Questions_${q}__Answers_0__Content`;
                        ans1Input.name = `Questionnaire.Questions[${q}].Answers[0].Content`;
                        ans1InputNumber.type = "hidden";
                        ans1InputNumber.value = 1;
                        ans1InputNumber.id = `Questionnaire_Questions_${q}__Answers_0__Number`;
                        ans1InputNumber.name = `Questionnaire.Questions[${q}].Answers[0].Number`;
                        ans1Div.appendChild(ans1Input);
                        ans1Div.appendChild(ans1InputNumber);
                        ans1Div.insertAdjacentHTML('beforeend', String.raw`<span class="text-danger field-validation-valid" data-valmsg-for="Questionnaire.Questions[${q}].Answers[0].Content" data-valmsg-replace="true"></span>`);

                        // ans 2 div
                        var ans2Div = document.createElement("div");
                        var ans2Input = document.createElement("input");
                        var ans2InputNumber = document.createElement("input");
                        var ans2Label = document.createElement("label");
                        // div
                        ans2Div.className += "form-group";
                        ans2Div.id = `ans2Div${q}`;
                        questionsContainer.appendChild(ans2Div);
                        //label
                        ans2Label.textContent = `Question ${q+1} - Answer 2`;
                        ans2Div.appendChild(ans2Label);
                        ans2Div.appendChild(document.createElement("br"));
                        // input content and number
                        ans2Input.type = "text";
                        ans2Input.className += "form-control";
                        ans2Input.required = true;
                        ans2Input.id = `Questionnaire_Questions_${q}__Answers_1__Content`;
                        ans2Input.name = `Questionnaire.Questions[${q}].Answers[1].Content`;
                        ans2InputNumber.type = "hidden";
                        ans2InputNumber.value = 2;
                        ans2InputNumber.id = `Questionnaire_Questions_${q}__Answers_1__Number`;
                        ans2InputNumber.name = `Questionnaire.Questions[${q}].Answers[1].Number`;
                        ans2Div.appendChild(ans2Input);
                        ans2Div.appendChild(ans2InputNumber);
                        ans2Div.insertAdjacentHTML('beforeend', String.raw`<span class="text-danger field-validation-valid" data-valmsg-for="Questionnaire.Questions[${q}].Answers[1].Content" data-valmsg-replace="true"></span>`);

                        // rest of the answers div
                        var xAnswersDiv = document.createElement("div");
                        xAnswersDiv.className += "form-group";
                        xAnswersDiv.id = `q${q}Answers`;
                        questionsContainer.appendChild(xAnswersDiv);

                        // div for the link
                        var ansLinkDiv = document.createElement("div");
                        ansLinkDiv.className += "form-group";
                        ansLinkDiv.id = `ansLinkDiv${q}`;
                        questionsContainer.appendChild(ansLinkDiv);
                        // link
                        let p1 = q; let p2 = xAnswersDiv.id;
                        ansLinkDiv.insertAdjacentHTML('beforeend', String.raw`<a href="javascript:void(0)" id="ansLink${q + 1}" onclick="addAnswers(${p1}, '${p2}')">Add answer</a>`);
                        q++;
                    }
                </script>
                <div class="form-group">
                    <input type="submit" value="Create" class="btn btn-primary" />
                </div>
            </form>
    </div>
</div>
<div>
    <a asp-page="Index">Back to List</a>
</div>

@section Scripts {
    @{await Html.RenderPartialAsync("_ValidationScriptsPartial");}

}
